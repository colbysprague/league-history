<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League History</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { margin-top: 2rem; }
        .table-container { margin-top: 2rem; overflow-x: auto; }
        #csvSelector { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>League History</h1>
        <select id="csvSelector" class="form-select">
            <option value="">Select a CSV file</option>
        </select>
        <div id="tableContainer" class="table-container"></div>
    </div>

    <script>
        $(document).ready(function() {
            // Function to fetch list of CSV files from the csv directory
            async function fetchCSVList() {
                try {
                    const response = await fetch('https://api.github.com/repos/colbysprague/league-history/contents/csv');
                    const files = await response.json();
                    const csvFiles = files.filter(file => file.name.endsWith('.csv'));
                    
                    csvFiles.forEach(file => {
                        $('#csvSelector').append(`<option value="${file.download_url}">${file.name}</option>`);
                    });
                } catch (error) {
                    console.error('Error fetching CSV list:', error);
                    $('#tableContainer').html('<div class="alert alert-danger">Error loading CSV files list</div>');
                }
            }

            // Function to load and parse CSV data
            function loadCSV(url) {
                Papa.parse(url, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        displayData(results.data);
                    },
                    error: function(error) {
                        console.error('Error parsing CSV:', error);
                        $('#tableContainer').html('<div class="alert alert-danger">Error parsing CSV file</div>');
                    }
                });
            }

            // Function to display CSV data in a table
            function displayData(data) {
                if (data.length === 0) {
                    $('#tableContainer').html('<div class="alert alert-warning">No data found</div>');
                    return;
                }

                const headers = Object.keys(data[0]);
                let tableHTML = '<table class="table table-striped table-bordered">\n<thead>\n<tr>';
                
                // Add headers
                headers.forEach(header => {
                    tableHTML += `<th>${header}</th>`;
                });
                tableHTML += '</tr>\n</thead>\n<tbody>';

                // Add data rows
                data.forEach(row => {
                    tableHTML += '<tr>';
                    headers.forEach(header => {
                        tableHTML += `<td>${row[header] || ''}</td>`;
                    });
                    tableHTML += '</tr>';
                });

                tableHTML += '</tbody></table>';
                $('#tableContainer').html(tableHTML);
            }

            // Event listener for CSV selection
            $('#csvSelector').change(function() {
                const selectedUrl = $(this).val();
                if (selectedUrl) {
                    $('#tableContainer').html('<div class="alert alert-info">Loading data...</div>');
                    loadCSV(selectedUrl);
                } else {
                    $('#tableContainer').empty();
                }
            });

            // Initialize by fetching CSV list
            fetchCSVList();
        });
    </script>
</body>
</html>